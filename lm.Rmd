---
title: "Statistical Analysis"
output: html_document
---

```{r, message=FALSE, echo=FALSE}
library(tidyverse)
library(rvest)
library(httr)
```

```{r, message=FALSE, echo=FALSE}
condom_data = 
  GET("https://data.cityofnewyork.us/resource/4kpn-sezh.csv") %>% 
  content("parsed")

cleaned_data = 
  condom_data %>% 
  select(facility_pk, facilityname, partnertype, partner_type_detailed, 
         address, borough, zipcode, latitude, longitude, phone, condoms_male,
         fc2_female_insertive_condoms, lubricant) %>% 
  rename(condoms_female = fc2_female_insertive_condoms) %>% 
  rename(partner_subtype = partner_type_detailed) %>% 
  mutate(
    condoms_male = as.factor(condoms_male), 
    condoms_male = fct_recode(condoms_male, "0" = "FALSE", "1" = "TRUE"),
    condoms_female = as.factor(condoms_female),
    condoms_female = fct_recode(condoms_female, "0" = "FALSE", "1" = "TRUE"),
    lubricant = as.factor(lubricant),
    lubricant = fct_recode(lubricant, "0" = "FALSE", "1" = "TRUE"),
    borough = as.factor(borough)
  )

cleaned_data$partnertype[cleaned_data$partnertype == "Community Based Organization/Non-Profit"] =
  "Community-Based Organization/Non-Profit"
```

## Logistic Regression Model for Female Condoms
We believe that boroughs, venues, and venue subtypes may influence the availability of condoms. These predictors were added as main effects and we build our model. Based on the table for female condoms, there are no significant associations between the predictor variables and the availability of condoms.
```{r, message=FALSE}
female_condom_logistic =
  cleaned_data %>% 
  glm(condoms_female~borough+partnertype+
        partner_subtype, data = ., family = binomial())

female_condom_logistic_df =
  female_condom_logistic %>% 
  broom::tidy() %>%
  select(term, estimate,p.value) %>% 
  knitr::kable(digits = 4)

female_condom_logistic_df
```


## Logistic Regression Model for Male Condoms  

### Model 1: Borough 
```{r, message=FALSE}
factored_data = 
cleaned_data %>% 
  mutate(
    partnertype = factor(partnertype),
    partner_subtype = factor(partner_subtype)
  )

logreg_model = 
  glm(condoms_male ~ borough, data = factored_data, family = "binomial")

logreg_model %>% 
  broom::tidy() %>% 
  janitor::clean_names() %>%
  mutate(
    term = str_replace(term, "boroughBrooklyn", "Brooklyn"),
    term = str_replace(term, "boroughManhattan", "Manhattan"),
    term = str_replace(term, "boroughQueens", "Queens"),
    term = str_replace(term, "boroughStaten Island", "Staten Island")) %>% 
  dplyr::select(-c(std_error, statistic)) %>% 
  knitr::kable(digits = 4)
```

### Model 2: Borough + Partnertype  
```{r, message=FALSE, warning=FALSE}
logreg_model2 =
  glm(condoms_male ~ borough + partnertype, data = factored_data, family = "binomial")

logreg_model2 %>% 
  broom::tidy() %>% 
  janitor::clean_names() %>%
  mutate(
    term = str_replace(term, "boroughBrooklyn", "Brooklyn"),
    term = str_replace(term, "boroughManhattan", "Manhattan"),
    term = str_replace(term, "boroughQueens", "Queens"),
    term = str_replace(term, "boroughStaten Island", "Staten Island")) %>% 
  mutate(
    term = str_replace(term, "partnertypeCommunity Health Center", "Community Health Center"),
    term = str_replace(term, "partnertypeCommunity-Based Organization/Non-Profit", "Community-Based Organization/Non-Profit"),
    term = str_replace(term, "partnertypeEducation", "Education"),
    term = str_replace(term, "partnertypeFaith-Based Organization", "Faith-Based Organization"),
    term = str_replace(term, "partnertypeGovernment", "Government"),
    term = str_replace(term, "partnertypeHospital", "Hospital"),
    term = str_replace(term, "partnertypePharmacy", "Pharmacy"),
    term = str_replace(term, "partnertypePrivate Practice", "Private Practice"),
    term = str_replace(term, "partnertypeSexual Health Clinics (NYC DOHMH)",
                       "Sexual Health Clinics (NYC DOHMH)")
    ) %>% 
  dplyr::select(-c(std_error, statistic)) %>% 
  knitr::kable(digits = 4)
```

Note above that all of the p-values are greater than 0.05, meaning that none of the predictors are significant.Borough and partner/venue type are not significant predictors of male condom availability. This is not too surprising, considering that all 5 boroughs and most partner types have male_condoms. Logistic regression might not be suitable model for our example. 

